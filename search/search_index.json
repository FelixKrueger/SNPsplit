{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Overview","text":"<p>06 January, 2023; [v0.6.0]</p>"},{"location":"#general","title":"General","text":"<p>SNPsplit is an allele-specific alignment sorter which is designed to read alignment files in SAM/BAM format and determine the allelic origin of reads that cover known SNP positions. For this to work a library must have been aligned to a genome which had all SNP positions masked by the ambiguity base \u2019N\u2019, and aligned using aligners that are capable of using a reference genome which contains ambiguity nucleobases. Examples of supported alignment programs are Bowtie2, HISAT2, Bismark, HiCUP, or STAR (for some tips using HISAT2 or STAR alignments please see below). BWA does not support this mode of action. In addition, a list of all known SNP positions between the two different genomes must be provided using the option <code>--snp_file</code>. SNP information to generate N-masked genomes needs to be acquired elsewhere, e.g. for different strains of mice you can find variant call files at the Mouse Genomes Project page. </p> <p>SNPsplit offers a separate genome preparation step that allows you to generate N-masked (or fully incorporated) SNP genomes for single or dual hybrid strains for all strains of the Mouse Genomes Project. Please see the genome preparation section for further details.</p> <p>SNPsplit operates in two stages:</p>"},{"location":"#i-snpsplit-tag","title":"I) SNPsplit tag:","text":"<p>SNPsplit analyses reads (single-end mode) or read pairs (paired-end mode) for overlaps with known SNP positions, and writes out a tagged BAM file in the same order as the original file. Unsorted paired-end files are sorted by name first.</p>"},{"location":"#ii-snpsplit-sort","title":"II) SNPsplit sort:","text":"<p>The tagged BAM file is read in again and sorted into allele-specific files. This process may also be run as a stand-alone module on tagged BAM files (<code>tag2sort</code>).</p> <p>The SNPsplit tag module determines whether a read can be assigned to a certain allele and appends an additional optional field <code>XX:Z:</code> to each read. The tag can be one of the following:</p> <pre><code>XX:Z:UA - Unassigned\nXX:Z:G1 - Genome 1-specific\nXX:Z:G2 - Genome 2-specific\nXX:Z:CF - Conflicting\n</code></pre> <p>The SNPsplit sort module <code>tag2sort</code> reads in the tagged BAM file and sorts the reads (or read pairs) according to their <code>XX:Z:</code> tag (or the combination of tags for paired-end or Hi-C reads) into sub-files.</p>"},{"location":"UCSC/","title":"Note for using a UCSC/NCBI genome in conjunction with the VCF file from the Mouse Genomes Project","text":"<p>Several users have run into problems when using genomes from UCSC or NCBI in conjunction with the VCF file from the Mouse Genomes Project (MGP, https://www.mousegenomes.org/). The reason for this is that the MGP uses chromosomal coordinates from Ensembl (i.e. <code>1, 2, 3, X, MT</code>) whereas UCSC uses chromosome names that look like this: <code>chr1, chr2, chr3, chrX, chrM</code>.</p> <p>We have recently added a check to the SNPsplit genome preparation script that will bail if a chromosome name discrepancy is detected (https://github.com/FelixKrueger/SNPsplit/issues/4). It is however possible to convert the VCF file into a UCSC compatible version by (a) changing the chromosome name from e.g. <code>1</code> to <code>chr1</code> and (b) adding changing the chromosome names in the ID field of the VCF file headers. It is normally not necessary to change the name of the mitochondrium from <code>MT</code> to <code>chrM</code> because no SNP positions are recorded for the MT anyway.</p> <p>Here is a one line <code>awk</code> script that does an Ensembl=&gt;UCSC conversion, but you could of course also run an equivalent script in Python or Perl... <pre><code>awk '{if($1 ~ \"^#\") {gsub(\"contig=&lt;ID=\", \"contig=&lt;ID=chr\"); gsub(\"contig=&lt;ID=chrMT\", \"contig=&lt;ID=chrM\"); print} else {gsub(\"^MT\", \"M\"); print \"chr\"$0}}' mgp_REL2021_snps.vcf.gz\n</code></pre></p>"},{"location":"workflow/","title":"SNPsplit workflow","text":"<p>The general workflow for working with SNPsplit is outlined below.</p>  <p>Note</p> <p>Steps 1-3 are only required as a one-off</p>  <ol> <li> <p>Obtain the SNP annotation file from the Mouse Genomes Project. The latest file is v8 (12/2021).</p> </li> <li> <p>Download the Mouse reference genome from Ensembl (GRCm39)</p> </li> <li> <p>Create an N-masked reference genome using the VCF file from 1.) (either single strain or dual hybrid). This step creates the SNP file required for the <code>SNPsplit</code> step (6.))</p> </li> </ol>  <p>Note</p> <p>Steps 4-6 need to be carried out for each sample</p>  <ol> <li> <p>Use aligner of choice to index the new N-masked reference genome</p> </li> <li> <p>Run alignments against the N-masked reference using your favourite aligner</p> </li> <li> <p>Run <code>SNPsplit</code> on the resulting BAM file, using the SNP file generated in 3.)</p> </li> </ol> <p>Once this workflow has completed, proceed to downstream analysis of your choice (outside the scope of SNPsplit).</p> <p>If you are still using the older mouse genome build GRCm38 you may find some information here.</p>"},{"location":"Examples/examples/","title":"Examples","text":""},{"location":"Examples/examples/#paired-end-report-2x50bp","title":"Paired-end report (2x50bp):","text":"<p><pre><code>Input file:                 'FVBNJ_Cast.bam'\nWriting allele-flagged output file to:  'FVBNJ_Cast.allele_flagged.bam'\n\n\nAllele-tagging report\n=====================\nProcessed 194564995 read alignments in total\n149380724 reads were unassignable (76.78%)\n35143075 reads were specific for genome 1 (18.06%)\n9860248 reads were specific for genome 2 (5.07%)\n118662 reads did not contain one of the expected bases at known SNP positions (0.06%)\n180948 contained conflicting allele-specific SNPs (0.09%)\n\n\nSNP coverage report\n===================\nN-containing reads: 45276050\nnon-N:          149262062\ntotal:          194564995\nReads had a deletion of the N-masked position (and were thus dropped):  26883 (0.01%)\nOf which had multiple deletions of N-masked positions within the same read: 30\n\nOf valid N containing reads,\nN was present in the list of known SNPs:        61087551 (99.99%)\nN was not present in the list of SNPs:      4773 (0.01%)\n\nInput file:                     'FVBNJ_Cast.allele_flagged.bam'\nWriting unassigned reads to:                'FVBNJ_Cast.unassigned.bam'\nWriting genome 1-specific reads to:         'FVBNJ_Cast.genome1.bam'\nWriting genome 2-specific reads to:         'FVBNJ_Cast.genome2.bam'\n\n\nAllele-specific paired-end sorting report\n=========================================\nRead pairs/singletons processed in total:       98215744\n    thereof were read pairs:            96349251\n    thereof were singletons:            1866493\nReads were unassignable (not overlapping SNPs): 61174812 (62.29%)\n    thereof were read pairs:    59662537\n    thereof were singletons:    1512275\nReads were specific for genome 1:           28657857 (29.18%)\n    thereof were read pairs:    28446094\n    thereof were singletons:    211763\nReads were specific for genome 2:           8122687 (8.27%)\n    thereof were read pairs:    7985424\n    thereof were singletons:    137263\nReads contained conflicting SNP information:        260388 (0.27%)\n    thereof were read pairs:    255196\n    thereof were singletons:    5192\n</code></pre> </p>"},{"location":"Examples/examples/#hi-c-report-2x100bp","title":"Hi-C report (2x100bp):","text":"<pre><code>Input file:                 Black6_129S1.bam\nWriting allele-flagged output file to:  Black6_129S1.allele_flagged.bam\n\n\nAllele-tagging report\n=====================\nProcessed 94887256 read alignments in total\n59662038 reads were unassignable (62.88%)\n19851697 reads were specific for genome 1 (20.92%)\n15047281 reads were specific for genome 2 (15.86%)\n47261 reads did not contain one of the expected bases at known SNP positions (0.05%)\n326240 contained conflicting allele-specific SNPs (0.34%)\n\n\nSNP coverage report\n===================\nN-containing reads: 35231977\nnon-N:          59614777\ntotal:          94887256\nReads had a deletion of the N-masked position (and were thus dropped):  40502 (0.04%)\nOf which had multiple deletions of N-masked positions within the same read: 59\n\nOf valid N containing reads,\nN was present in the list of known SNPs:    57101748 (99.99%)\nN was not present in the list of SNPs:  4211 (0.01%)\n\nInput file:                     Black6_129S1.allele_flagged.bam'\nWriting unassigned reads to:                Black6_129S1.UA_UA.bam'\nWriting genome 1-specific reads to:         Black6_129S1.G1_G1.bam'\nWriting genome 2-specific reads to:         Black6_129S1.G2_G2.bam'\nWriting G1/UA reads to:             Black6_129S1.G1_UA.bam'\nWriting G2/UA reads to:             Black6_129S1.G2_UA.bam'\nWriting G1/G2 reads to:             Black6_129S1.G1_G2.bam'\n\n\nAllele-specific paired-end sorting report\n=========================================\nRead pairs processed in total:          47443628\nRead pairs were unassignable (UA/UA):           18862725 (39.76%)\nRead pairs were specific for genome 1 (G1/G1):  3533932 (7.45%)\nRead pairs were specific for genome 2 (G2/G2):  2592040 (5.46%)\nRead pairs were a mix of G1 and UA:         12306421 (25.94%). Of these,\n            were G1/UA: 6018598\n            were UA/G1: 6287823\nRead pairs were a mix of G2 and UA:         9430675 (19.88%). Of these,\n            were G2/UA: 4603429\n            were UA/G2: 4827246\nRead pairs were a mix of G1 and G2:         395296 (0.83%). Of these,\n            were G1/G2: 198330\n            were G2/G1: 196966\nRead pairs contained conflicting SNP information:   322539 (0.68%)\n</code></pre>"},{"location":"Examples/examples/#bs-seq-report-2x100bp","title":"BS-Seq report (2x100bp):","text":"<pre><code>Input file:                 '129_Cast_bismark_bt2_pe.bam'\nWriting allele-flagged output file to:  '129_Cast_bismark_bt2_pe.allele_flagged.bam'\n\n\nAllele-tagging report\n=====================\nProcessed 162441396 read alignments in total\nReads were unaligned and hence skipped: 0 (0.00%)\n109109113 reads were unassignable (67.17%)\n30267901 reads were specific for genome 1 (18.63%)\n22697499 reads were specific for genome 2 (13.97%)\n15807753 reads did not contain one of the expected bases at known SNP positions (9.73%)\n366883 contained conflicting allele-specific SNPs (0.23%)\n\n\nSNP coverage report\n===================\nSNP annotation file:    ../all_Cast_SNPs_129S1_reference.mgp.v4.txt.gz\nN-containing reads: 68984287\nnon-N:          93301360\ntotal:          162441396\nReads had a deletion of the N-masked position (and were thus dropped):  155749 (0.10%)\nOf which had multiple deletions of N-masked positions within the same read: 65\n\nOf valid N containing reads,\nN was present in the list of known SNPs:    119119643 (99.99%)\nPositions were skipped since they involved C&gt;T SNPs:    38464451\nN was not present in the list of SNPs:      7517 (0.01%)\n\nInput file:                     129_Cast_bismark_bt2_pe.allele_flagged.bam'\nWriting unassigned reads to:                129_Cast_bismark_bt2_pe.unassigned.bam'\nWriting genome 1-specific reads to:         129_Cast_bismark_bt2_pe.genome1.bam'\nWriting genome 2-specific reads to:         129_Cast_bismark_bt2_pe.genome2.bam'\n\n\nAllele-specific paired-end sorting report\n=========================================\nRead pairs/singletons processed in total:       81220698\n    thereof were read pairs:            81220698\n    thereof were singletons:            0\nReads were unassignable (not overlapping SNPs):     40420625 (49.77%)\n    thereof were read pairs:    40420625\n    thereof were singletons:    0\nReads were specific for genome 1:           23037433 (28.36%)\n    thereof were read pairs:    23037433\n    thereof were singletons:    0\nReads were specific for genome 2:           17303663 (21.30%)\n    thereof were read pairs:    17303663\n    thereof were singletons:    0\nReads contained conflicting SNP information:        458977 (0.57%)\n    thereof were read pairs:    458977\n    thereof were singletons:    0\n</code></pre>"},{"location":"SNPsplit/details/","title":"The SNPsplit workflow in more detail","text":""},{"location":"SNPsplit/details/#1-sam2bam","title":"1) <code>sam2bam</code>","text":"<p>Optional. If the supplied file is a SAM file it will first be converted to BAM format (using <code>samtools view</code>).</p>"},{"location":"SNPsplit/details/#2-sorting","title":"2) Sorting","text":"<p>Paired-end files might require the input file to be sorted by read ID before continuing with the allele-tagging (Read 1 and Read 2 of a pair are expected to follow each other in the input BAM file). Unless specifically stated, paired-end BAM files will be sorted by read name (using <code>samtools sort -n</code>; output file ending in <code>.sortedByName.bam</code>). For files that already contain R1 and R2 on two consecutive lanes, the sorting step may be skipped using the option <code>--no_sort</code>. Single-end files or Hi-C files generated by HiCUP do not require sorting.</p>"},{"location":"SNPsplit/details/#3-storing-snp-positions","title":"3) Storing SNP positions","text":"<p>SNP positions are read in from the SNP file (which may be GZIP compressed (ending in <code>.gz</code>) or plain text files). The SNP file is expected to be in the following format (tab-delimited): </p> <pre><code>   ID      Chr   Position  SNP value    Ref/SNP\n18819008     5  48794752      1       C/T \n40491905    11  63643453      1       A/G \n44326884    12  96627819      1       T/A \n</code></pre> <p>Only the information contained in fields 'Chr (Chromosome)', 'Position' and 'Ref/SNP' base are being used for analysis. The genome containing the 'Ref' base is used for 'genome 1 specific reads (G1)', the genome containing the 'SNP' base for 'genome 2 specific reads (G2)'. If reads do not overlap any SNP positions they are considered 'Unassigned (UA)', i.e. they are not informative for one allele or another. In the rare case that a read contains both genome 1- and genome 2-specific base(s), or that the SNP position was deleted the read is regarded as 'Conflicting (CF)'.</p> <p>It is probably noteworthy that the determination of overlaps correctly handles the CIGAR operations M (match), D (deletion in the read), I (insertion in the read) and N (skipped regions, used for splice mapping by e.g. HISAT2 or STAR). Furthermore, soft-clipping (operation S) is also supported. Other CIGAR operations are currently not supported and cause SNPsplit to die.</p>"},{"location":"SNPsplit/details/#4-tagging-report","title":"4) Tagging report","text":"<p>Upon completion, a small allele-specific tagging report is printed to screen and to a report file (<code>.SNPsplit_report.txt</code>) for archiving purposes. </p>"},{"location":"SNPsplit/details/#5-tag2sort","title":"5) <code>tag2sort</code>","text":"<p>Once the tagging has completed, the <code>tag2sort</code> module reads in the tagged BAM file and sorts it into various sub-files according to their <code>XX:Z:</code> tag. Both single and paired-end files are sorted into the following four categories:</p> <pre><code>UA - Unassigned\nG1 - Genome 1-specific\nG2 - Genome 2-specific\nCF - Conflicting\n</code></pre> <p>Files with conflicting SNP information (tag <code>XX:Z:CF</code>) are not written out by default.</p>"},{"location":"SNPsplit/details/#6-sorting-report","title":"6) Sorting report","text":"<p>Upon completion, an allele-specific sorting report is printed out on screen and to a report file for archiving purposes (<code>*.SNPsplit_sort.txt</code>). If the sorting was launched by SNPsplit and not run stand-alone (as <code>tag2sort</code>) the sorting report is also appended to the main SNPsplit report (<code>*.SNPsplit_report.txt</code>).</p>"},{"location":"SNPsplit/specific_comments/","title":"Specific comments","text":"<p>In the following you can find some additional information for more specific applications or software</p>"},{"location":"SNPsplit/specific_comments/#paired-end","title":"Paired-end","text":"<p>In paired-end mode, both reads are used for the classification. Read pairs with conflicting reads (tag <code>CF</code>) or pairs containing both tags <code>G1</code> and <code>G2</code> are considered conflicting and are not reported by default. Reporting of these reads can be enabled using the option <code>--conflicting</code>.</p> <p>Singleton alignments in the allele-tagged paired-end file (which is the default for e.g. TopHat) are also sorted into the above four files. Specifying <code>--singletons</code> will write these alignments to special singleton files instead (ending in <code>*_st.bam</code>).</p>"},{"location":"SNPsplit/specific_comments/#hi-c","title":"Hi-C","text":"<p>Assumes data processed with HiCUP as input, i.e. the input BAM files are by definition paired-end and Reads 1 and 2 follow each other. Hi-C sorting discriminates several more possible read combinations:</p> <pre><code>G1-G1\nG2-G2\nG1-UA\nG2-UA\nG1-G2\nUA-UA\n</code></pre> <p>Again, read pairs containing a conflicting reads (tag <code>XX:Z:CF</code>) are not printed out by default, but this may be enabled using the option <code>--conflicting</code>. For an example report please see below.</p>"},{"location":"SNPsplit/specific_comments/#star","title":"STAR","text":"<p>RNA-seq alignment files produced by the Spliced Transcripts Alignment to a Reference (STAR) aligner also work well with SNPsplit, however a few steps need to be adhered to make this work:</p> <p>1) Since SNPsplit only recognises the CIGAR operations M, I, D and N (see above), alignments need to be run in end-to-end mode and not using local alignments (which may result in soft-clipping). This can be accomplished using the option: <code>--alignEndsType EndToEnd</code></p> <p>Edit 29 09 2020: As of version 0.4.0, SNPsplit also supports soft-clipped reads (CIGAR operation: S).</p> <p>2) SNPsplit requires the <code>MD:Z:</code> field of the BAM alignment to work out mismatches involving masked N positions. Since STAR doesn\u2019t report the <code>MD:Z:</code> field by default it needs to be instructed to do so, e.g.: <code>--outSAMattributes NH HI NM MD</code></p> <p>3) To save some time and avoid having to sort the reads by name, STAR can be told to leave R1 and R2 following each other in the BAM file using the option: <code>--outSAMtype BAM Unsorted</code></p>"},{"location":"SNPsplit/specific_comments/#hisat2","title":"HISAT2","text":"<p>DNA or RNA alignment files produced by HISAT2 also work well with SNPsplit if you make sure that HISAT2 doesn\u2019t perform soft-clipping. At the time of writing the current version of HISAT2 (2.0.3-beta) does perform soft-clipping (CIGAR operation: S) even though this is not well documented (or in fact the documentation on Github suggests that the default mode is end-to-end which should not perform any soft-clipping whatsoever). Until the end-to-end mode works as expected users will have to set the penalty for soft-clipping so high that it is effectively not performed (<code>--sp</code> is the option governing the soft-clipping penalty). We suggest adding the following option to the HISAT2 command: <code>--sp 1000,1000</code></p> <p>Edit: HISAT2 does now also have an option <code>--no-softclip</code> which should have the same effect.</p> <p>Edit 29 09 2020: As of version 0.4.0, SNPsplit also supports soft-clipped reads. (CIGAR operation: S).</p>"},{"location":"SNPsplit/specific_comments/#bwa","title":"BWA","text":"<p>The other very popular Burrows-Wheeler Aligner (BWA) is unfortunately not compatible with SNPsplit alignment sorting as was disscussed in more detail here. Briefly, the reason for this is that BWA randomly replaces the ambiguity nucleobase <code>N</code> in the reference by either <code>C</code>, <code>A</code>, <code>T</code> or <code>G</code>, thereby rendering an N-masked allele-sorting process impossible.</p>"},{"location":"SNPsplit/specific_comments/#bisulfite-seq-data","title":"Bisulfite-seq data","text":"<p>This mode assumes input data has been processed with the bisulfite mapping tool Bismark. SNPsplit will run a quick check at the start of a run to see if the file provided appears to be a Bismark file, and set the flags <code>--bisulfite</code> and/or <code>--paired</code> automatically. In addition it will perform a quick check to see if a paired-end file appears to have been positionally sorted, and if not will set the <code>--no_sort</code> flag (this data is extracted from the <code>@PG</code> header line). Paired-end (<code>--paired</code>) or bisulfite (<code>--bisulfite</code>) mode can also be set manually. Paired-end mode requires Read 1 and Read 2 of a pair to follow each other in consecutive lines. Please be aware that files should not be name-sorted using <code>Sambamba</code>.</p>"},{"location":"SNPsplit/specific_comments/#utilisation-of-snp-positions-and-allele-assignment-of-bisulfite-reads","title":"Utilisation of SNP positions and allele assignment of bisulfite reads","text":"<p>In contrast to the standard mode of using all known SNP positions, SNPs involving C to T transitions may not be used for allele-specific sorting since they might reflect either a SNP or a methylation state. This includes all of the following Reference/SNP combinations: </p> <p>C/T or T/C for forward strand alignments, and G/A or A/G for reverse strand alignments. </p> <p>The number of SNP positions that have been skipped because of this bisulfite ambiguity is reported in the report file. These positions may however be used to assign opposing strand alignments since they do not involve C to T transitions directly. For that reason, the bisulfite call processing also extracts the bisulfite strand information from the alignments in addition to the base call at the position involved. For any SNPs involving C positions that are not C to T SNPs both methylation states, i.e. C and T, are allowed to match the C position.</p> <p>For SNPs which are masked by Ns in the genome no methylation call will be performed, i.e. they will receive a <code>.</code> (dot) in the methylation call string. This means that SNP positions are used for allele-sorting only but do not participate in calling methylation. While this may reduce the number of total methylation calls somewhat it effectively eliminates the problem of using positions with potentially incorrect methylation status.</p>"},{"location":"genome_prep/genome_preparation/","title":"SNPsplit genome preparation","text":"<p><code>SNPsplit_genome_preparation</code> is designed to read in a variant call file from the Mouse Genomes Project (this latest v8 file) and generate new genome versions where the strain SNPs are either incorporated into the new genome (full sequence) or masked by the ambiguity nucleobase <code>N</code> (N-masking).</p> <p><code>SNPsplit_genome_preparation</code> may be run in two different modes:</p>"},{"location":"genome_prep/genome_preparation/#single-strain-mode","title":"Single strain mode:","text":"<p>1) The VCF file is read and filtered for high-confidence SNPs in the strain specified with <code>--strain &lt;name&gt;</code></p> <p>2) The reference genome (given with <code>--reference_genome &lt;genome&gt;</code>) is read into memory, and the filtered high-confidence SNP positions are incorporated either as N-masking (default), or full sequence (option <code>--full_sequence</code>)</p>"},{"location":"genome_prep/genome_preparation/#dual-strain-mode","title":"Dual strain mode:","text":"<p>1) The VCF file is read and filtered for high-confidence SNPs in the strain specified with <code>--strain &lt;name&gt;</code></p> <p>2) The reference genome (given with <code>--reference_genome &lt;genome&gt;</code>) is read into memory, and the filtered high-confidence SNP positions are incorporated as full sequence and optionally as N-masking</p> <p>3) The VCF file is read one more time and filtered for high-confidence SNPs in strain 2 specified with <code>--strain2 &lt;name&gt;</code></p> <p>4) The filtered high-confidence SNP positions of strain 2 are incorporated as full sequence, and optionally as N-masking</p> <p>5) The SNP information of strain and strain 2 relative to the reference genome build are compared, and a new Ref/SNP annotation is constructed whereby the new Ref/SNP information will be Strain/Strain2 (and no longer the standard reference genome strain Black6 (C57BL/6J)). Later on, genome 1 will correspond to 'strain', genome 2 to 'strain2'.</p> <p>6) The full genome sequence given with <code>--strain &lt;name&gt;</code> is read into memory, and the high-confidence SNP positions between Strain and Strain2 are incorporated as full sequence, and optionally as N-masking</p> <p>The resulting <code>.fa</code> files are ready to be indexed with your favourite aligner. Proven and tested aligners include Bowtie2, Tophat, STAR, HISAT2, HiCUP and Bismark. Please note that BWA does not support alignments to N-masked genome (see here).</p> <p>Both the SNP filtering and the genome preparation write out report files for record keeping.</p>"},{"location":"genome_prep/genome_preparation/#filtering-high-confidence-snps-from-the-vcf-file","title":"Filtering high confidence SNPs from the VCF file","text":"<p>This section describes in more detail the process of how high confidence SNPs are extracted from the VCF file mgp_REL2021_snps.vcf.gz. We are first going to paste the start of the VCF file and explain in more detail later the individual steps taken by the SNPsplit genome preparation for the strain CAST_EiJ as an example; the PDF version of the user guide had relevant information in the header lines or the variant data itself are marked in dark red, but unfotunately this is not supported in this markdown version, so please look carefully... . This should help you adapt the process to other genomes/VCF files should you wish to do so.</p> <pre><code>##fileformat=VCFv4.2\n##FILTER=&lt;ID=PASS,Description=\"All filters passed\"&gt;\n##bcftoolsVersion=1.13+htslib-1.13\n##bcftoolsCommand=mpileup -f Mus_musculus.GRCm39.dna.toplevel.fa.gz -b samples -g 10 -a FORMAT/DP,FORMAT/AD,FORMAT/ADF,FORMAT/ADR,FORMAT/SP,INFO/AD -E -Q 0 -pm 3 -F 0.25 -d 500\n##reference=Mus_musculus.GRCm39.dna.toplevel.fa.gz\n##contig=&lt;ID=1,length=195154279&gt;\n##contig=&lt;ID=2,length=181755017&gt;\n##contig=&lt;ID=3,length=159745316&gt;\n##contig=&lt;ID=4,length=156860686&gt;\n##contig=&lt;ID=5,length=151758149&gt;\n##contig=&lt;ID=6,length=149588044&gt;\n##contig=&lt;ID=7,length=144995196&gt;\n##contig=&lt;ID=8,length=130127694&gt;\n##contig=&lt;ID=9,length=124359700&gt;\n##contig=&lt;ID=10,length=130530862&gt;\n##contig=&lt;ID=11,length=121973369&gt;\n##contig=&lt;ID=12,length=120092757&gt;\n##contig=&lt;ID=13,length=120883175&gt;\n##contig=&lt;ID=14,length=125139656&gt;\n##contig=&lt;ID=15,length=104073951&gt;\n##contig=&lt;ID=16,length=98008968&gt;\n##contig=&lt;ID=17,length=95294699&gt;\n##contig=&lt;ID=18,length=90720763&gt;\n##contig=&lt;ID=19,length=61420004&gt;\n##contig=&lt;ID=X,length=169476592&gt;\n##ALT=&lt;ID=*,Description=\"Represents allele(s) other than observed.\"&gt;\n##INFO=&lt;ID=INDEL,Number=0,Type=Flag,Description=\"Indicates that the variant is an INDEL.\"&gt;\n##INFO=&lt;ID=IDV,Number=1,Type=Integer,Description=\"Maximum number of raw reads supporting an indel\"&gt;\n##INFO=&lt;ID=IMF,Number=1,Type=Float,Description=\"Maximum fraction of raw reads supporting an indel\"&gt;\n##INFO=&lt;ID=DP,Number=1,Type=Integer,Description=\"Raw read depth\"&gt;\n##FORMAT=&lt;ID=PL,Number=G,Type=Integer,Description=\"List of Phred-scaled genotype likelihoods\"&gt;\n##FORMAT=&lt;ID=DP,Number=1,Type=Integer,Description=\"Number of high-quality bases\"&gt;\n##FORMAT=&lt;ID=AD,Number=R,Type=Integer,Description=\"Allelic depths (high-quality bases)\"&gt;\n##INFO=&lt;ID=AD,Number=R,Type=Integer,Description=\"Total allelic depths (high-quality bases)\"&gt;\n##INFO=&lt;ID=END,Number=1,Type=Integer,Description=\"End position of the variant described in this record\"&gt;\n##INFO=&lt;ID=MinDP,Number=1,Type=Integer,Description=\"Minimum per-sample depth in this gVCF block\"&gt;\n##FORMAT=&lt;ID=GT,Number=1,Type=String,Description=\"Genotype\"&gt;\n##FORMAT=&lt;ID=GQ,Number=1,Type=Integer,Description=\"Phred-scaled Genotype Quality\"&gt;\n##INFO=&lt;ID=DP4,Number=4,Type=Integer,Description=\"Number of high-quality ref-forward , ref-reverse, alt-forward and alt-reverse bases\"&gt;\n##INFO=&lt;ID=MQ,Number=1,Type=Integer,Description=\"Average mapping quality\"&gt;\n##bcftools_callCommand=call -mAv -f GQ,GP -p 0.99; Date=Wed Aug 11 21:20:03 2021\n##bcftools_normCommand=norm --fasta-ref Mus_musculus.GRCm39.dna.toplevel.fa.gz -m +indels; Date=Fri Aug 13 11:11:49 2021\n##FORMAT=&lt;ID=FI,Number=1,Type=Integer,Description=\"High confidence (1) or low confidence (0) based on soft filtering values\"&gt;\n##FILTER=&lt;ID=LowQual,Description=\"Low quality variants\"&gt;\n##VEP=\"v104\" time=\"2021-08-30 23:27:00\" cache=\"mus_musculus/104_GRCm39\" ensembl-funcgen=104.59ae779 ensembl-variation=104.6154f8b ensembl=104.1af1dce ensembl-io=104.1d3bb6e assembly=\"GRCm39\" dbSNP=\"150\" gencode=\"GENCODE M27\" regbuild=\"1\n.0\" sift=\"sift\"\n##INFO=&lt;ID=CSQ,Number=.,Type=String,Description=\"Consequence annotations from Ensembl VEP. Format: Allele|Consequence|IMPACT|SYMBOL|Gene|Feature_type|Feature|BIOTYPE|EXON|INTRON|HGVSc|HGVSp|cDNA_position|CDS_position|Protein_position|Am\nino_acids|Codons|Existing_variation|DISTANCE|STRAND|FLAGS|VARIANT_CLASS|SYMBOL_SOURCE|HGNC_ID|SIFT|MOTIF_NAME|MOTIF_POS|HIGH_INF_POS|MOTIF_SCORE_CHANGE|TRANSCRIPTION_FACTORS\"&gt;\n##bcftools_viewVersion=1.13+htslib-1.13\n##bcftools_viewCommand=view -i 'FORMAT/FI[*] = 1' mgp_REL2021_snps.vcf.gz; Date=Sat Dec 18 19:08:09 2021\n##bcftools_annotateVersion=1.13+htslib-1.13\n##bcftools_annotateCommand=annotate -x INFO/VDB,INFO/SGB,INFO/RPBZ,INFO/MQBZ,INFO/MQBZ,INFO/MQSBZ,INFO/BQBZ,INFO/SCBZ,INFO/FS,INFO/MQOF,INFO/AC,INFO/AN,FORMAT/SP,FORMAT/ADF,FORMAT/ADR,FORMAT/GP; Date=Sat Dec 18 19:08:09 2021\n##INFO=&lt;ID=AC,Number=A,Type=Integer,Description=\"Allele count in genotypes\"&gt;\n##INFO=&lt;ID=AN,Number=1,Type=Integer,Description=\"Total number of alleles in called genotypes\"&gt;\n##bcftools_viewCommand=view -a -Oz -o final_mgp_REL2021_snps.vcf.gz; Date=Sat Dec 18 19:08:09 2021\n##bcftools_annotateCommand=annotate -x INFO/MQ0F -Oz -o final_mgp_REL2021_snps.vcf.gz mgp_REL2021_snps.vcf.gz; Date=Mon Dec 20 07:12:23 2021\n#CHROM  POS ID  REF ALT QUAL    FILTER  INFO    FORMAT  129P2_OlaHsd    129S1_SvImJ 129S5SvEvBrd    A_J AKR_J   B10.RIII    BALB_cByJ   BALB_cJ BTBR_T+_Itpr3tf_J   BUB_BnJ C3H_HeH C3H_HeJ C57BL_10J   C57BL_10SnJ C57BL_6NJ   C57BR_cdJ   C57L_J  C58_J   CAST_EiJ    CBA_J   CE_J    CZECHII_EiJ DBA_1J  DBA_2J  FVB_NJ  I_LnJ   JF1_MsJ KK_HiJ  LEWES_EiJ   LG_J    LP_J    MAMy_J  MOLF_EiJ    NOD_ShiLtJ  NON_LtJ NZB_B1NJ    NZO_HlLtJ   NZW_LacJ    PL_J    PWK_PhJ QSi3    QSi5    RF_J    RIIIS_J SEA_GnJ SJL_J   SM_J    SPRET_EiJ   ST_bJ   SWR_J   WSB_EiJ ZALENDE_EiJ\n1   3050050 .   C   G   186.728 PASS    DP=3533;AD=3488,42;DP4=3041,447,44,1;MQ=60;CSQ=G|intergenic_variant|MODIFIER|||||||||||||||||||SNV||||||||,A|intergenic_variant|MODIFIER|||||||||||||||||||SNV||||||||;AC=2;AN=104  GT:PL:DP:AD:GQ:FI   0/0:0,57,168:19:19,0:71:1   0/0:0,108,255:36:36,0:122:1 0/0:0,30,154:10:10,0:44:1   0/0:0,199,255:66:66,0:127:1 0/0:0,84,222:28:28,0:98:1   0/0:0,208,255:69:69,0:127:1 0/0:0,163,255:54:54,\n0:127:1 0/0:0,223,255:74:74,0:127:1 0/0:0,138,255:46:46,0:127:1 0/0:0,93,254:31:31,0:107:1  0/0:0,9,85:3:3,0:23:0   0/0:0,111,242:37:37,0:125:1 0/0:0,120,255:40:40,0:127:1 0/0:0,154,233:51:51,0:127:1 0/0:0,223,25\n5:74:74,0:127:1 0/0:0,255,255:171:171,0:127:0   0/0:0,255,255:213:212,0:127:0   0/0:0,181,255:60:60,0:127:1 0/0:0,163,255:54:54,0:127:1 0/0:0,96,255:32:32,0:110:1  0/0:0,190,255:63:63,0:127:1 0/0:0,255,255:500:499,0:127:\n0   0/0:0,93,255:31:31,0:107:1  0/0:0,96,255:32:32,0:110:1  0/0:0,51,233:17:17,0:65:1   0/0:0,90,255:30:30,0:104:1  0/0:0,255,255:220:220,0:127:0   0/0:0,255,255:106:106,0:127:1   0/0:0,196,255:65:65,0:127:0 0/0:\n0,18,178:6:6,0:32:1 0/0:0,93,231:31:31,0:107:1  0/0:0,69,255:23:23,0:83:1   0/0:0,255,255:208:208,0:127:0   0/0:0,96,255:32:32,0:110:1  0/0:0,81,255:27:27,0:95:1   0/0:0,111,255:37:37,0:125:1 0/0:0,199,255:66:66,\n0:127:1 0/0:0,144,255:49:48,0:127:1 0/0:0,57,255:19:19,0:71:1   0/0:0,255,255:366:366,0:127:0   0/0:0,93,255:31:31,0:107:1  0/0:0,78,255:26:26,0:92:1   0/0:0,69,255:23:23,0:83:1   0/0:0,187,255:62:62,0:127:1 0/0:\n0,166,255:55:55,0:127:1 0/0:0,54,224:18:18,0:68:1   0/0:0,12,122:4:4,0:26:0 1/1:252,126,0:42:0,42:105:1 0/0:0,151,255:50:50,0:127:1 0/0:0,114,255:38:38,0:127:1 0/0:0,226,255:75:75,0:127:1 0/0:0,39,201:13:13,0:53:1\n1   3050069 .   C   T   5422.31 PASS    DP=3674;AD=2868,796;DP4=2447,421,659,147;MQ=60;CSQ=T|intergenic_variant|MODIFIER|||||||||||||||||||SNV||||||||,A|intergenic_variant|MODIFIER|||||||||||||||||||SNV||||||||,G|interge\nnic_variant|MODIFIER|||||||||||||||||||SNV||||||||;AC=45;AN=104 GT:PL:DP:AD:GQ:FI   1/1:198,72,0:24:0,24:67:1   1/1:255,120,0:40:0,40:115:1 1/1:149,27,0:9:0,9:22:1 0/0:0,208,255:69:69,0:127:1 1/1:253,90,0:35:1,34:85:1   0/0:0,226,255:75:75,0:127:1 0/0:0,166,255:55:55,0:127:1 0/0:0,199,255:66:66,0:127:1 1/1:255,160,0:53:0,53:127:1 1/1:255,96,0:32:0,32:91:1   0/0:0,12,119:4:4,0:10:0 0/0:0,129,255:43:43,0:127:1 0/0:0,123,255:41:41,\n0:121:1 0/0:0,148,255:50:49,0:127:1 0/0:0,223,255:74:74,0:127:1 0/1:200,0,255:175:138,37:127:0  0/1:104,0,255:235:190,44:105:0  0/0:0,163,255:54:54,0:127:1 0/1:179,0,226:55:28,27:127:0    0/0:0,93,255:31:31,0:91:1   0/1:\n255,0,255:65:35,30:127:0    0/0:0,255,255:493:467,26:127:0  0/0:0,96,255:32:32,0:94:1   0/0:0,105,255:35:35,0:103:1 1/1:234,72,0:24:0,24:67:1   1/1:255,90,0:30:0,30:85:1   0/0:0,255,255:228:219,8:127:0   0/0:0,255,25\n5:109:109,0:127:1   0/0:0,181,255:61:60,0:127:0 0/0:0,24,170:9:8,0:22:1 1/1:239,96,0:32:0,32:91:1   1/1:252,63,0:22:0,21:58:1   0/0:0,255,255:228:226,1:127:0   1/1:255,105,0:35:0,35:100:1 1/1:255,84,0:28:0,28:79:1   0/1:255,0,178:36:17,19:127:0    0/0:0,208,255:70:69,0:127:1 0/0:0,138,255:46:46,0:127:1 1/1:255,75,0:25:0,25:70:1   0/0:0,255,255:387:368,18:127:0  1/1:255,123,0:41:0,41:118:1 1/1:255,87,0:29:0,29:82:1   0/0:0,81,255\n:27:27,0:79:1   0/0:0,205,255:68:68,0:127:1 0/0:0,172,255:57:57,0:127:1 1/1:222,57,0:19:0,19:52:1   1/1:142,18,0:6:0,6:13:0 0/0:0,114,255:38:38,0:112:1 1/1:255,148,0:49:0,49:127:1 1/1:255,117,0:39:0,39:112:1 0/0:\n0,208,255:70:69,0:127:1 1/1:251,48,0:16:0,16:43:1\n\u2026\n</code></pre>"},{"location":"genome_prep/genome_preparation/#detecting-strains","title":"Detecting strains","text":"<p>To detect the available strains in the VCF file as well as to determine the column number of a desired strain in the file we skim through the header lines until we find a line starting with #CHROM. In terms of the strains in the file the next eight fields are irrelevant: </p> <p><code>#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT</code></p> <p>The following fields should contain the strains listed in the file, here:</p> <pre><code>129S1_SvImJ 129S5SvEvBrd    A_J AKR_J   B10.RIII    BALB_cByJ   BALB_cJ BTBR_T+_Itpr3tf_J   BUB_BnJ C3H_HeH C3H_HeJ C57BL_10J   C57BL_10SnJ C57BL_6NJ   C57BR_cdJ   C57L_J  C58_J   CAST_EiJ    CBA_J   CE_J    CZECHII_EiJ DBA_1J  DBA_2J  FVB_NJ  I_LnJ   JF1_MsJ KK_HiJ  LEWES_EiJ   LG_J    LP_J    MAMy_J  MOLF_EiJ    NOD_ShiLtJ  NON_LtJ NZB_B1NJ    NZO_HlLtJ   NZW_LacJ    PL_J    PWK_PhJ QSi3    QSi5    RF_J    RIIIS_J SEA_GnJ SJL_J   SM_J    SPRET_EiJ   ST_bJ   SWR_J   WSB_EiJ ZALENDE_EiJ\n</code></pre> <p>In our example the data for strain CAST_EiJ would be found in column 28, or have an index of 27 (the index = column - 1 because index counting starts at 0 and not at 1). </p> <p>If #CHROM is not present in the VCF file header, the automated lookup and subsequent steps will fail.</p>"},{"location":"genome_prep/genome_preparation/#detecting-chromosomes","title":"Detecting chromosomes","text":"<p>Chromosomes to be processed are detected from the VCF header lines starting with ##contig=, e.g. here: <p><pre><code>##contig=&lt;ID=1,length=195154279&gt;\n##contig=&lt;ID=2,length=181755017&gt;\n\u2026\n</code></pre> The IDs here are the chromosomes for which variant calls are available, but not necessarily all chromosomes in the genome have to be present here. If there are no variant calls for say \u201cchrY\u201d then the subsequent genome preparation step will simply not introduce any changes but use the reference sequence for \u201cchrY\u201d.</p> <p>If the ##contig=\u2026 fields are missing from the VCF file, subsequent steps are probably going to fail; as a way around this you might get away with defining the chromosome array manually, e.g. like so:</p> <p><code>my @chroms = (1..19,\u2019X\u2019,\u2019Y\u2019,\u2019MT\u2019);</code></p>"},{"location":"genome_prep/genome_preparation/#dealing-with-variant-calls","title":"Dealing with Variant Calls","text":"<p>For variant calls the SNPsplit genome preparation extracts the following information from each line:</p> <pre><code>CHROM  [Col 1]\nPOS    [Col 2]\nREF    [Col 4]\nALT    [Col 5]\nSTRAIN [Col 28 (for CAST_EiJ)]\n</code></pre> <p>Which in our case is (three example lines only):</p> <pre><code>CHROM   POS REF ALT CAST_EiJ\n1   3050050 C   G   1/1:0,163,255:54:54,0:127:0\n1   3050076 C   T   0/0:0,214,255:71:71,0:127:0 \n1   3050069 C   T   1/1:234,72,0:24:0,24:67:1\n</code></pre> <p>Now the STRAIN field contains a lot of information which is specified in the FORMAT field and further \u2018explained\u2019 in the VCF header. The format is:  <pre><code>GT:PL:DP:AD:GQ:FI\n</code></pre></p> <p>I am not going into the details about all these FORMAT tags (feel free to browse the header section above), but suffice it to say that the SNPsplit genome preparation only cares about the GT (=GENOTYPE) and FI (=FILTER) entry which are defined as:</p> <pre><code>##FORMAT=&lt;ID=GT,Number=1,Type=String,Description=\"Genotype\"&gt;\n</code></pre>"},{"location":"genome_prep/genome_preparation/#gt-genotype","title":"GT (Genotype)","text":"<p>The GT string can be one of the following: <pre><code>'.'    = no genotype call was made\n'0/0'  = genotype is the same as the reference genome\n'1/1'  = homozygous alternative allele; can also be '2/2', '3/3', etc. if more than one alternative allele is present.\n'0/1'  = heterozygous genotype; can also be '1/2', '0/2', etc.\n</code></pre></p> <p>For the mouse strains we are working with here we only accept homozygous alternative alleles, so '1/1', \u20182/2\u2019 or \u20183/3\u2019. Any other combination is recorded and mentioned in the final report but not included in the SNP file.</p>"},{"location":"genome_prep/genome_preparation/#fi-filter","title":"FI (Filter)","text":"<pre><code>##FORMAT=&lt;ID=FI,Number=1,Type=Integer,Description=\"High confidence (1) or low confidence (0) based on soft filtering values\"&gt;\n</code></pre> <p>Next we are looking at the FILTER field. If a SNP variant call passed all filters for a given strain it will PASS or get a value of 1. Else it will have a value of 0. In the example above the first position had a genotype of 1/1 but did not pass the Filter for the CAST_EiJ strain (FI value = 0), so this position won\u2019t be included:</p> <pre><code>1   3050050 C   G   1/1:0,163,255:54:54,0:127:0 \n</code></pre> <p>The second position did not indicate that there was a SNP (0/0), so the positions wouldn\u2019t be considered for a single-hybrid genome anyway. However, the filter call for that position was uncertain (FI value = 0), so this position would also not be considered for a SNP position in <code>--dual_hybrid</code> mode even if the other strain had a high confidence SNP at this position (this behaviour was introduced in v0.3.2).</p> <pre><code>1   3050076 C   T   0/0:0,214,255:71:71,0:127:0\n</code></pre> <p>The third position finally is a high-confidence homozygous SNP which would be included for both single and dual hybrid genomes:</p> <pre><code>1   3050069 C   T   1/1:234,72,0:24:0,24:67:1\n</code></pre>"},{"location":"genome_prep/genome_preparation/#clearly-defined-clean-genotype","title":"Clearly defined clean genotype","text":"<p>And finally, variants are required to have a clearly defined genotype, e.g. a made-up position: <pre><code>12  45630185    A   T/C\n</code></pre></p> <p>would not be included as a valid SNP position because the alternative allele is not clearly defined (unless the genotype would be 2/2 here, in which case the reference would be \u2018A\u2019 and the alternative allele would be \u2018C\u2019).</p> <p>If you are dealing with any VCF file other than the one used as an example here you might need to adapt one or more of the issues addressed here to make it work.</p>"},{"location":"genome_prep/legacy/","title":"Legacy (v5/GRCm38)","text":"<p>Warning</p> <p>This document references the now outdated mouse genome build GRCm38 and the equally outdated v5 annotation, please consider it a legacy version only. We do not recommend or support this old version any longer, please go here for the most recent genome/annotation version.</p>  <p><code>SNPsplit_genome_preparation</code> is designed to read in a variant call file from the Mouse Genomes Project (e.g. this v5 file, GRCm38) and generate new genome versions where the strain SNPs are either incorporated into the new genome (full sequence) or masked by the ambiguity nucleobase <code>N</code> (N-masking).</p> <p><code>SNPsplit_genome_preparation</code> may be run in two different modes:</p>"},{"location":"genome_prep/legacy/#single-strain-mode","title":"Single strain mode:","text":"<p>1) The VCF file is read and filtered for high-confidence SNPs in the strain specified with <code>--strain &lt;name&gt;</code></p> <p>2) The reference genome (given with <code>--reference_genome &lt;genome&gt;</code>) is read into memory, and the filtered high-confidence SNP positions are incorporated either as N-masking (default), or full sequence (option <code>--full_sequence</code>)</p>"},{"location":"genome_prep/legacy/#dual-strain-mode","title":"Dual strain mode:","text":"<p>1) The VCF file is read and filtered for high-confidence SNPs in the strain specified with <code>--strain &lt;name&gt;</code></p> <p>2) The reference genome (given with <code>--reference_genome &lt;genome&gt;</code>) is read into memory, and the filtered high-confidence SNP positions are incorporated as full sequence and optionally as N-masking</p> <p>3) The VCF file is read one more time and filtered for high-confidence SNPs in strain 2 specified with <code>--strain2 &lt;name&gt;</code></p> <p>4) The filtered high-confidence SNP positions of strain 2 are incorporated as full sequence, and optionally as N-masking</p> <p>5) The SNP information of strain and strain 2 relative to the reference genome build are compared, and a new Ref/SNP annotation is constructed whereby the new Ref/SNP information will be Strain/Strain2 (and no longer the standard reference genome strain Black6 (C57BL/6J))</p> <p>6) The full genome sequence given with <code>--strain &lt;name&gt;</code> is read into memory, and the high-confidence SNP positions between Strain and Strain2 are incorporated as full sequence, and optionally as N-masking</p> <p>The resulting <code>.fa</code> files are ready to be indexed with your favourite aligner. Proved and tested aligners include Bowtie2, Tophat, STAR, HISAT2, HiCUP and Bismark. Please note that STAR and HISAT2 may require you to disable soft-clipping, please see above for more details.</p> <p>Both the SNP filtering and the genome preparation write out report files for record keeping.</p>"},{"location":"genome_prep/legacy/#filtering-high-confidence-snps-from-the-vcf-file","title":"Filtering high confidence SNPs from the VCF file","text":"<p>This section describes in more detail the process of how high confidence SNPs are extracted from the sample VCF file mgp.v5.merged.snps_all.dbSNP142.vcf.gz. We are first going to paste the start of the VCF file and explain in more detail later the individual steps taken by the SNPsplit genome preparation for the strain CAST_EiJ as an example strain; the PDF version of the user guide had relevant information in the header lines or the variant data itself are marked in dark red, but unfotunately this is not supported in this markdown version, so please look carefully... . This should help you adapt the process to other genomes/VCF files should you wish to do so.</p> <pre><code>VCF file: mgp.v5.merged.snps_all.dbSNP142.vcf.gz\n##fileformat=VCFv4.2\n##FILTER=&lt;ID=PASS,Description=\"All filters passed\"&gt;\n##samtoolsVersion=1.1+htslib-1.1\n##bcftools_callVersion=1.1+htslib-1.1\n##reference=ftp://ftp-mouse.sanger.ac.uk/ref/GRCm38_68.fa\n##source_20141009.1=vcf-annotate(r953) -f +/D=50/d=5/q=20/w=2/a=5/ (chromosomes=1-19,X,Y: C3H_HeH)\n##source_20141009.1=vcf-annotate(r953) -f +/D=100/d=5/q=20/w=2/a=5/ (chromosomes=1-19,X,Y: 129S5SvEvBrd,ZALENDE_EiJ,LEWES_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=200/d=5/q=20/w=2/a=5/ (chromosomes=1-19,X,Y: C57BL_10J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=250/d=5/q=20/w=2/a=5/ (chromosomes=1-19,X,Y: 129P2_OlaHsd,A_J,CAST_EiJ,LP_J,PWK_PhJ,WSB_EiJ,BUB_BnJ,DBA_1J,I_LnJ,MOLF_EiJ,NZB_B1NJ,SEA_GnJ,RF_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=300/d=5/q=20/w=2/a=5/ (chromosomes=1-19,X,Y: AKR_J,BALB_cJ,C3H_HeJ,C57BL_6NJ,CBA_J,DBA_2J,C57BR_cdJ,C58_J,NZW_LacJ,C57L_J,KK_HiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=350/d=5/q=20/w=2/a=5/ (chromosomes=1-19,X,Y: 129S1_SvImJ,FVB_NJ,NOD_ShiLtJ,NZO_HlLtJ,SPRET_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=400/d=5/q=20/w=2/a=5/ (chromosomes=1-19,X,Y: BTBR_T+_Itpr3tf_J,ST_bJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=350/d=5/q=20/w=2/a=5/ (chromosome=MT: LEWES_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=650/d=5/q=20/w=2/a=5/ (chromosome=MT: I_LnJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=850/d=5/q=20/w=2/a=5/ (chromosome=MT: BUB_BnJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=1000/d=5/q=20/w=2/a=5/ (chromosome=MT: SEA_GnJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=1200/d=5/q=20/w=2/a=5/ (chromosome=MT: C57BL_10J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=1300/d=5/q=20/w=2/a=5/ (chromosome=MT: RF_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=1450/d=5/q=20/w=2/a=5/ (chromosome=MT: KK_HiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=1550/d=5/q=20/w=2/a=5/ (chromosome=MT: NZB_B1NJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=1800/d=5/q=20/w=2/a=5/ (chromosome=MT: ZALENDE_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=2200/d=5/q=20/w=2/a=5/ (chromosome=MT: C3H_HeH)\n##source_20141009.1=vcf-annotate(r953) -f +/D=2300/d=5/q=20/w=2/a=5/ (chromosome=MT: ST_bJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=3050/d=5/q=20/w=2/a=5/ (chromosome=MT: C57L_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=3650/d=5/q=20/w=2/a=5/ (chromosome=MT: MOLF_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=4250/d=5/q=20/w=2/a=5/ (chromosome=MT: NZW_LacJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=4650/d=5/q=20/w=2/a=5/ (chromosome=MT: C3H_HeJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=5300/d=5/q=20/w=2/a=5/ (chromosome=MT: C57BR_cdJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=6150/d=5/q=20/w=2/a=5/ (chromosome=MT: DBA_1J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=6200/d=5/q=20/w=2/a=5/ (chromosome=MT: 129S5SvEvBrd,C58_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=6650/d=5/q=20/w=2/a=5/ (chromosome=MT: C57BL_6NJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=6700/d=5/q=20/w=2/a=5/ (chromosome=MT: WSB_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=6900/d=5/q=20/w=2/a=5/ (chromosome=MT: CBA_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=7100/d=5/q=20/w=2/a=5/ (chromosome=MT: BALB_cJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=7450/d=5/q=20/w=2/a=5/ (chromosome=MT: NZO_HlLtJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=7650/d=5/q=20/w=2/a=5/ (chromosome=MT: PWK_PhJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=8300/d=5/q=20/w=2/a=5/ (chromosome=MT: SPRET_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=8850/d=5/q=20/w=2/a=5/ (chromosome=MT: CAST_EiJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=9550/d=5/q=20/w=2/a=5/ (chromosome=MT: 129S1_SvImJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=9600/d=5/q=20/w=2/a=5/ (chromosome=MT: LP_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=9850/d=5/q=20/w=2/a=5/ (chromosome=MT: DBA_2J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=10200/d=5/q=20/w=2/a=5/ (chromosome=MT: BTBR_T__Itpr3tf_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=11300/d=5/q=20/w=2/a=5/ (chromosome=MT: AKR_J)\n##source_20141009.1=vcf-annotate(r953) -f +/D=11550/d=5/q=20/w=2/a=5/ (chromosome=MT: NOD_ShiLtJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=11700/d=5/q=20/w=2/a=5/ (chromosome=MT: 129P2_OlaHsd)\n##source_20141009.1=vcf-annotate(r953) -f +/D=11750/d=5/q=20/w=2/a=5/ (chromosome=MT: FVB_NJ)\n##source_20141009.1=vcf-annotate(r953) -f +/D=11800/d=5/q=20/w=2/a=5/ (chromosome=MT: A_J)\n##contig=&lt;ID=1,length=195471971&gt;\n##contig=&lt;ID=10,length=130694993&gt;\n##contig=&lt;ID=11,length=122082543&gt;\n##contig=&lt;ID=12,length=120129022&gt;\n##contig=&lt;ID=13,length=120421639&gt;\n##contig=&lt;ID=14,length=124902244&gt;\n##contig=&lt;ID=15,length=104043685&gt;\n##contig=&lt;ID=16,length=98207768&gt;\n##contig=&lt;ID=17,length=94987271&gt;\n##contig=&lt;ID=18,length=90702639&gt;\n##contig=&lt;ID=19,length=61431566&gt;\n##contig=&lt;ID=2,length=182113224&gt;\n##contig=&lt;ID=3,length=160039680&gt;\n##contig=&lt;ID=4,length=156508116&gt;\n##contig=&lt;ID=5,length=151834684&gt;\n##contig=&lt;ID=6,length=149736546&gt;\n##contig=&lt;ID=7,length=145441459&gt;\n##contig=&lt;ID=8,length=129401213&gt;\n##contig=&lt;ID=9,length=124595110&gt;\n##contig=&lt;ID=X,length=171031299&gt;\n##contig=&lt;ID=Y,length=91744698&gt;\n##contig=&lt;ID=MT,length=16299&gt;\n##ALT=&lt;ID=X,Description=\"Represents allele(s) other than observed.\"&gt;\n##QUAL=&lt;ID=QUAL,Number=1,Type=Float,Description=\"The highest QUAL value for a variant location from any of the samples\"&gt;\n##INFO=&lt;ID=INDEL,Number=0,Type=Flag,Description=\"Indicates that the variant is an INDEL.\"&gt;\n##INFO=&lt;ID=DP,Number=1,Type=Integer,Description=\"Raw read depth\"&gt;\n##INFO=&lt;ID=DP4,Number=4,Type=Integer,Description=\"Total Number of high-quality ref-fwd, ref-reverse, alt-fwd and alt-reverse bases\"&gt;\n##INFO=&lt;ID=CSQ,Number=.,Type=String,Description=\"Consequence type from Ensembl 75 as predicted by VEP. Format: Allele|Gene|Feature|Feature_type|Consequence|cDNA_position|CDS_position|Protein_position|Amino_acids|Codons|Existing_variation|DISTANCE|STRAND\"&gt;\n##FORMAT=&lt;ID=GT,Number=1,Type=String,Description=\"Genotype\"&gt;\n##FORMAT=&lt;ID=GQ,Number=1,Type=Integer,Description=\"Phred-scaled Genotype Quality\"&gt;\n##FORMAT=&lt;ID=DP,Number=1,Type=Integer,Description=\"Number of high-quality bases\"&gt;\n##FORMAT=&lt;ID=MQ0F,Number=1,Type=Float,Description=\"Fraction of MQ0 reads (smaller is better)\"&gt;\n##FORMAT=&lt;ID=GP,Number=G,Type=Float,Description=\"Phred-scaled genotype posterior probabilities\"&gt;\n##FORMAT=&lt;ID=PL,Number=G,Type=Integer,Description=\"List of Phred-scaled genotype likelihoods\"&gt;\n##FORMAT=&lt;ID=AN,Number=1,Type=Integer,Description=\"Total number of alleles in called genotypes\"&gt;\n##FORMAT=&lt;ID=MQ,Number=1,Type=Integer,Description=\"Average mapping quality\"&gt;\n##FORMAT=&lt;ID=DV,Number=1,Type=Integer,Description=\"Number of high-quality non-reference bases\"&gt;\n##FORMAT=&lt;ID=DP4,Number=4,Type=Integer,Description=\"Number of high-quality ref-fwd, ref-reverse, alt-fwd and alt-reverse bases\"&gt;\n##FORMAT=&lt;ID=SP,Number=1,Type=Integer,Description=\"Phred-scaled strand bias P-value\"&gt;\n##FORMAT=&lt;ID=SGB,Number=1,Type=Float,Description=\"Segregation based metric.\"&gt;\n##FORMAT=&lt;ID=PV4,Number=4,Type=Float,Description=\"P-values for strand bias, baseQ bias, mapQ bias and tail distance bias\"&gt;\n##FORMAT=&lt;ID=FI,Number=1,Type=Integer,Description=\"Whether a sample was a Pass(1) or fail (0) based on FILTER values\"&gt;\n##FILTER=&lt;ID=StrandBias,Description=\"Min P-value for strand bias (INFO/PV4) [0.0001]\"&gt;\n##FILTER=&lt;ID=EndDistBias,Description=\"Min P-value for end distance bias (INFO/PV4) [0.0001]\"&gt;\n##FILTER=&lt;ID=MaxDP,Description=\"Maximum read depth (INFO/DP or INFO/DP4) []\"&gt;\n##FILTER=&lt;ID=BaseQualBias,Description=\"Min P-value for baseQ bias (INFO/PV4) [0]\"&gt;\n##FILTER=&lt;ID=MinMQ,Description=\"Minimum RMS mapping quality for SNPs (INFO/MQ) [20]\"&gt;\n##FILTER=&lt;ID=MinAB,Description=\"Minimum number of alternate bases (INFO/DP4) [5]\"&gt;\n##FILTER=&lt;ID=Qual,Description=\"Minimum value of the QUAL field [10]\"&gt;\n##FILTER=&lt;ID=VDB,Description=\"Minimum Variant Distance Bias (INFO/VDB) [0]\"&gt;\n##FILTER=&lt;ID=GapWin,Description=\"Window size for filtering adjacent gaps [3]\"&gt;\n##FILTER=&lt;ID=MapQualBias,Description=\"Min P-value for mapQ bias (INFO/PV4) [0]\"&gt;\n##FILTER=&lt;ID=SnpGap,Description=\"SNP within INT bp around a gap to be filtered [2]\"&gt;\n##FILTER=&lt;ID=RefN,Description=\"Reference base is N []\"&gt;\n##FILTER=&lt;ID=MinDP,Description=\"Minimum read depth (INFO/DP or INFO/DP4) [5]\"&gt;\n##FILTER=&lt;ID=Het,Description=\"Genotype call is heterozygous (low quality) []\"&gt;\n#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  129P2_OlaHsd    129S1_SvImJ     129S5SvEvBrd    AKR_J   A_J     BALB_cJ BTBR_T+_Itpr3tf_J       BUB_BnJ C3H_HeH C3H_HeJ C57BL_10J       C57BL_6NJ       C57BR_cdJ   C57L_J   C58_J   CAST_EiJ        CBA_J   DBA_1J  DBA_2J  FVB_NJ  I_LnJ   KK_HiJ  LEWES_EiJ       LP_J    MOLF_EiJ        NOD_ShiLtJ      NZB_B1NJ        NZO_HlLtJ       NZW_LacJ        PWK_PhJ RF_J    SEA_GnJ SPRET_EiJ       ST_bJ   WSB_EiJ      ZALENDE_EiJ\n1       3000023 .       C       A       153     MinDP;MinAB;Qual;Het    DP=170;DP4=2,0,168,0;CSQ=A||||intergenic_variant||||||||        GT:GQ:DP:MQ0F:GP:PL:AN:MQ:DV:DP4:SP:SGB:PV4:FI  1/1:20:8:0:133,20,0:109,11,0:2:29:7:1,0,7,0:0:-0.6364\n26:.:1  1/1:22:6:0.166667:152,22,0:137,18,0:2:36:6:0,0,6,0:0:-0.616816:.:1      1/1:11:4:0:70,11,0:51,4,0:2:24:3:1,0,3,0:0:-0.511536:.:0        1/1:15:4:0.25:80,15,0:68,12,0:2:25:4:0,0,4,0:0:-0.556411:.:0    1/1:11:3:0:72,11,0:63,9,0:2:3\n4:3:0,0,3,0:0:-0.511536:.:0     0/1:3:1:0:40,3,3:37,3,0:2:40:1:0,0,1,0:0:-0.379885:.:0  1/1:36:10:0:194,36,0:174,30,0:2:38:10:0,0,10,0:0:-0.670168:.:1  1/1:22:6:0.333333:111,22,0:96,18,0:2:20:6:0,0,6,0:0:-0.616816:.:1       0/1:3:1:0:35,\n3,3:32,3,0:2:40:1:0,0,1,0:0:-0.379885:.:0       1/1:19:5:0:135,19,0:121,15,0:2:34:5:0,0,5,0:0:-0.590765:.:1     1/1:15:4:0:106,15,0:94,12,0:2:29:4:0,0,4,0:0:-0.556411:.:0      1/1:11:3:0:83,11,0:74,9,0:2:28:3:0,0,3,0:0:-0.511536:.:0    1/1:33:9:0:199,33,0:180,27,0:2:42:9:0,0,9,0:0:-0.662043:.:1      1/1:6:2:0:56,6,0:50,6,0:2:27:2:0,0,2,0:0:-0.453602:.:0  1/1:15:4:0.5:75,15,0:63,12,0:2:25:4:0,0,4,0:0:-0.556411:.:0     1/1:15:4:0:79,15,0:67,12,0:2:24:4:0,0,4,0:0:-0.556411\n:.:0    1/1:22:6:0:133,22,0:118,18,0:2:31:6:0,0,6,0:0:-0.616816:.:1     1/1:15:4:0:108,15,0:96,12,0:2:35:4:0,0,4,0:0:-0.556411:.:0      1/1:15:4:0.25:88,15,0:76,12,0:2:31:4:0,0,4,0:0:-0.556411:.:0    0/0:.:1:0:.,.,.:.,.,.:2:40:1:0,0,1,0:\n0:-0.379885:.:0 1/1:11:3:0:79,11,0:70,9,0:2:31:3:0,0,3,0:0:-0.511536:.:0        1/1:6:2:0.5:48,6,0:42,6,0:2:20:2:0,0,2,0:0:-0.453602:.:0        1/1:15:4:0.5:70,15,0:58,12,0:2:22:4:0,0,4,0:0:-0.556411:.:0     1/1:6:2:0:69,6,0:63,6,0:2:40:\n2:0,0,2,0:0:-0.453602:.:0       1/1:19:5:0.2:94,19,0:80,15,0:2:24:5:0,0,5,0:0:-0.590765:.:1     1/1:15:4:0:87,15,0:75,12,0:2:30:4:0,0,4,0:0:-0.556411:.:0       1/1:26:7:0.142857:150,26,0:134,21,0:2:31:7:0,0,7,0:0:-0.636426:.:1      1/1:1\n9:5:0:132,19,0:118,15,0:2:48:5:0,0,5,0:0:-0.590765:.:1  1/1:30:8:0:171,30,0:153,24,0:2:37:8:0,0,8,0:0:-0.651104:.:1     1/1:11:3:0.333333:72,11,0:63,9,0:2:33:3:0,0,3,0:0:-0.511536:.:0 1/1:19:5:0:137,19,0:123,15,0:2:38:5:0,0,5,0:0:-0.5907\n65:.:1  1/1:22:6:0.166667:137,22,0:122,18,0:2:42:6:0,0,6,0:0:-0.616816:.:1      1/1:33:9:0:140,33,0:121,27,0:2:23:9:0,0,9,0:0:-0.662043:.:1     1/1:33:9:0.111111:170,33,0:151,27,0:2:29:9:0,0,9,0:0:-0.662043:.:1      1/1:26:7:0:140,26,0:1\n24,21,0:2:31:7:0,0,7,0:0:-0.636426:.:1  1/1:6:2:0:48,6,0:42,6,0:2:21:2:0,0,2,0:0:-0.453602:.:0\n1       3000126 rs580370473     G       T       184     MinDP;MinMQ;Het;MinAB;Qual      DP=417;DP4=93,1,210,113;CSQ=T||||intergenic_variant||||||||     GT:GQ:DP:MQ0F:GP:PL:AN:MQ:DV:DP4:SP:SGB:PV4:FI  1/1:4:8:0:89,4,1:75,0,1:2:36:5:3,0,4,\n1:0:-0.590765:.:1       1/1:21:12:0:152,21,0:128,12,0:2:55:9:3,0,7,2:0:-0.662043:.:1    0/0:.:2:0:.,.,.:.,.,.:2:16:0:2,0,0,0:0:.:.:0    0/1:9:11:0:91,0,9:82,0,11:2:48:9:2,0,6,3:0:-0.662043:.:0        1/1:6:5:0:67,6,1:51,1,0:2:44:3:2,0,1,\n2:4:-0.511536:.:0       1/1:5:10:0:97,5,1:82,0,0:2:56:8:2,0,7,1:0:-0.651104:.:1 1/1:31:28:0:173,31,0:151,23,0:2:50:21:7,0,6,15:28:-0.692352:.:1 1/1:18:8:0:135,18,0:110,9,0:2:56:6:2,0,3,3:3:-0.616816:.:1      1/1:11:3:0:55,11,0:46,9,0:2:3\n7:3:0,0,1,2:0:-0.511536:.:0     1/1:50:14:0:111,50,0:89,42,0:2:41:14:0,0,14,0:0:-0.686358:.:1   1/1:23:7:0:115,23,0:86,12,0:2:38:6:1,0,1,5:0:-0.616816:.:1      1/1:6:8:0:66,6,1:52,2,0:2:49:5:3,0,5,0:0:-0.590765:.:1  1/1:60:17:0.0588235:2\n17,60,0:193,51,0:2:52:17:0,0,12,5:0:-0.690438:.:1       1/1:75:33:0:244,75,0:211,62,0:2:52:30:3,0,17,13:6:-0.693097:.:1 1/1:47:13:0:217,47,0:195,39,0:2:49:13:0,0,4,9:0:-0.683931:.:1   0/0:.:5:0:.,.,.:.,.,.:2:47:4:1,0,4,0:0:-0.556411:.:01/1:43:12:0:117,43,0:96,36,0:2:47:12:0,0,12,0:0:-0.680642:.:1    1/1:29:8:0:189,29,0:155,15,0:2:53:7:1,0,3,4:0:-0.636426:.:1     1/1:15:4:0:73,15,0:61,12,0:2:59:4:0,0,4,0:0:-0.556411:.:0       0/1:5:6:0:76,1,5:66,0,7:2:50:4:2,0,4,0:0:-0.5\n56411:.:0       1/1:13:9:0:97,13,0:78,7,0:2:45:6:3,0,4,2:3:-0.616816:.:1        1/1:37:15:0.0666667:195,37,0:165,25,0:2:52:13:2,0,7,6:3:-0.683931:.:1   1/1:11:21:0.666667:38,11,0:35,12,0:2:9:6:15,0,3,3:18:-0.616816:.:0      1/1:19:6:0:92\n,19,0:67,10,0:2:47:5:1,0,5,0:0:-0.590765:.:1    1/1:10:30:0.4:101,10,0:88,7,0:2:24:14:16,0,0,14:82:-0.686358:.:1        0/1:21:7:0:51,0,21:46,0,21:2:48:5:2,0,4,1:0:-0.590765:.:0       1/1:14:7:0.142857:80,14,0:60,7,0:2:44:5:1,1,4,1:0:-0.\n590765:.:1      1/1:5:14:0:101,5,1:86,0,0:2:52:9:5,0,9,0:0:-0.662043:.:1        1/1:33:9:0:196,33,0:177,27,0:2:53:9:0,0,6,3:0:-0.662043:.:1     1/1:26:7:0:91,26,0:75,21,0:2:50:7:0,0,7,0:0:-0.636426:.:1       1/1:44:24:0:138,44,0:119,38,0\n:2:45:23:1,0,19,4:0:-0.692717:.:1       1/1:17:8:0:101,17,0:79,9,0:2:53:6:2,0,4,2:0:-0.616816:.:1       0/1:20:11:0.0909091:72,0,20:65,0,21:2:45:7:4,0,7,0:0:-0.636426:.:0      1/1:33:23:0:183,33,0:159,24,0:2:50:18:5,0,6,12:19:-0.691153:.\n:1      1/1:11:7:0:66,11,0:49,6,0:2:54:5:2,0,5,0:0:-0.590765:.:1        1/1:19:5:0:62,19,0:48,15,0:2:54:5:0,0,5,0:0:-0.590765:.:1\n...\n</code></pre>"},{"location":"genome_prep/legacy/#detecting-strains","title":"Detecting strains","text":"<p>To detect the available strains in the VCF file as well as to determine the column number of a desired strain in the file we skim through the header lines until we find a line starting with #CHROM. In terms of the strains in the file the next eight fields are irrelevant: </p> <p><code>#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT</code></p> <p>The following fields should contain the strains listed in the file, here:  <code>129P2_OlaHsd   129S1_SvImJ 129S5SvEvBrd    AKR_J   A_J BALB_cJ BTBR_T+_Itpr3tf_J   BUB_BnJ C3H_HeH C3H_HeJ C57BL_10J   C57BL_6NJ   C57BR_cdJ   C57L_J  C58_J   CAST_EiJ    CBA_J   DBA_1J \u2026</code></p> <p>In our example the data for strain CAST_EiJ would be found in column 25, or have an index of 24 (the index = column - 1 because index counting starts at 0 and not at 1). </p> <p>If #CHROM is not present in the VCF file header, the automated lookup and subsequent steps will fail.</p>"},{"location":"genome_prep/legacy/#detecting-chromosomes","title":"Detecting chromosomes","text":"<p>Chromosomes to be processed are detected from the VCF header lines starting with ##contig=, e.g. here: <p><pre><code>##contig=&lt;ID=1,length=195471971&gt;\n##contig=&lt;ID=10,length=130694993&gt;\n\u2026\n</code></pre> The IDs here are the chromosomes for which variant calls are available, but not necessarily all chromosomes in the genome have to be present here. If there are no variant calls for say \u201cchrY\u201d then the subsequent genome preparation step will simply not introduce any changes but use the reference sequence for \u201cchrY\u201d.</p> <p>If the ##contig=\u2026 fields are missing from the VCF file, subsequent steps are probably going to fail; as a way around this you might get away with defining the chromosome array manually, e.g. like so:</p> <p><code>my @chroms = (1..19,\u2019X\u2019,\u2019Y\u2019,\u2019MT\u2019);</code></p>"},{"location":"genome_prep/legacy/#dealing-with-variant-calls","title":"Dealing with Variant Calls","text":"<p>For variant calls the SNPsplit genome preparation extracts the following information from each line:</p> <pre><code>CHROM  [Col 1]\nPOS    [Col 2]\nREF    [Col 4]\nALT    [Col 5]\nSTRAIN [Col 25 (for CAST_EiJ)]\n</code></pre> <p>Which in our case is (first three lines only): <pre><code>CHROM   POS REF ALT CAST_EiJ\n1   3000023 C   A   1/1:15:4:0:79,15,0:67,12,0:2:24:4:0,0,4,0:0:-0.556411:.:0\n1   3000126 G   T   0/0:.:5:0:.,.,.:.,.,.:2:47:4:1,0,4,0:0:-0.556411:.:0\n1   3000185 G   T   1/1:43:12:0:276,43,0:255,36,0:2:54:12:0,0,10,2:0:-0.680642:.:1\n</code></pre></p> <p>Now the STRAIN field contains a lot of information which is specified in the FORMAT field and further \u2018explained\u2019 in the VCF header. The format is:  <pre><code>GT:GQ:DP:MQ0F:GP:PL:AN:MQ:DV:DP4:SP:SGB:PV4:FI\n</code></pre></p> <p>I am not going into the details about all these FORMAT tags (feel free to browse the header section above), but suffice it to say that the SNPsplit genome preparation only cares about the GT (=GENOTYPE) and FI (=FILTER) entry which are defined as:</p>"},{"location":"genome_prep/legacy/#gt-genotype","title":"GT (Genotype)","text":"<pre><code>##FORMAT=&lt;ID=GT,Number=1,Type=String,Description=\"Genotype\"&gt;\n</code></pre> <p>The GT string can be one of the following: <pre><code>'.'    = no genotype call was made\n'0/0'  = genotype is the same as the reference genome\n'1/1'  = homozygous alternative allele; can also be '2/2', '3/3', etc. if more than one alternative allele is present.\n'0/1'  = heterozygous genotype; can also be '1/2', '0/2', etc.\n</code></pre></p> <p>For the mouse strains we are working with here we only accept homozygous alternative alleles, so '1/1', \u20182/2\u2019 or \u20183/3\u2019. Any other combination is recorded and mentioned in the final report but not included in the SNP file.</p>"},{"location":"genome_prep/legacy/#fi-filter","title":"FI (Filter)","text":"<pre><code>##FORMAT=&lt;ID=FI,Number=1,Type=Integer,Description=\"Whether a sample was a Pass(1) or fail (0) based on FILTER values\"&gt;\n</code></pre> <p>Next we are looking at the FILTER field. If a SNP variant call passed all filters for a given strain it will PASS or get a value of 1. Else it will have a value of 0. In the example above the first position had a genotype of 1/1 but did not pass the Filter for the CAST_EiJ strain (FI value = 0), so this position won\u2019t be included:</p> <pre><code>1   3000023 C   A   1/1:15:4:0:79,15,0:67,12,0:2:24:4:0,0,4,0:0:-0.556411:.:0\n</code></pre> <p>The second position did not indicate that there was a SNP (0/0), so the positions wouldn\u2019t be considered for a single-hybrid genome anyway. However, the filter call for that position was uncertain (FI value = 0), so this position would also not be considered for a SNP position in --dual_hybrid mode even if the other strain had a high confidence SNP at this position (this behaviour was introduced in v0.3.2).</p> <pre><code>1   3000126 G   T   0/0:.:5:0:.,.,.:.,.,.:2:47:4:1,0,4,0:0:-0.556411:.:0\n</code></pre> <p>The third position finally is a high-confidence homozygous SNP which would be included for both single and dual hybrid genomes:</p> <pre><code>1   3000185 G   T   1/1:43:12:0:276,43,0:255,36,0:2:54:12:0,0,10,2:0:-0.680642:.:1\n</code></pre>"},{"location":"genome_prep/legacy/#clearly-defined-clean-genotype","title":"Clearly defined clean genotype","text":"<p>And finally, variants are required to have a clearly defined genotype, e.g. a made-up position: <pre><code>12  45630185    A   T/C\n</code></pre></p> <p>would not be included as a valid SNP position because the alternative allele is not clearly defined (unless the genotype would be 2/2 here, in which case the reference would be \u2018A\u2019 and the alternative allele would be \u2018C\u2019).</p> <p>If you are dealing with any other VCF file than the one used as an example here you might need to adapt one or more of the issues addressed here to make it work.</p>"},{"location":"options/SNPsplit_options/","title":"SNPsplit","text":""},{"location":"options/SNPsplit_options/#full-list-of-options-for-snpsplit","title":"Full list of options for SNPsplit","text":"<p>Note</p> <p>USAGE: <code>SNPsplit [options] --snp_file &lt;SNP.file.gz&gt; [input file(s)]</code></p>  <ul> <li><code>Input file(s)</code></li> </ul> <p>Mapping output file in SAM or BAM format. SAM files (ending in <code>.sam</code>) will first be converted to BAM files.</p> <ul> <li><code>--snp_file</code></li> </ul> <p>Mandatory file specifying SNP positions to be considered, may be a plain text file of gzip compressed. Currently, the SNP file is expected to be in the following format:</p> <pre><code>   SNP-ID     Chromosome  Position    Strand   Ref/SNP\n 33941939           9             68878541       1           T/G\n</code></pre> <p>Only the information contained in fields 'Chromosome', 'Position' and 'Ref/SNP base' are being used for analysis. The genome referred to as 'Ref' will be used as genome 1, the genome containing the 'SNP' base as genome 2.</p> <ul> <li><code>--single_end</code></li> </ul> <p>Manually sets data to single-end. Skips AUTO-DETECT</p> <ul> <li><code>--paired</code></li> </ul> <p>Paired-end mode. (Default: AUTO-DETECT)</p> <ul> <li><code>-o/--outdir &lt;dir&gt;</code></li> </ul> <p>Write all output files into this directory. By default the output files will be written into the same folder as the input file(s). If the specified folder does not exist, SNPsplit will attempt to create it first. The path to the output folder can be either relative or absolute.</p> <ul> <li><code>--singletons</code></li> </ul> <p>If the allele-tagged paired-end file also contains singleton alignments (which is the default for e.g. TopHat), these will be written out to extra files (ending in <code>_st.bam</code>) instead of writing everything to combined paired-end and singleton files. Default: OFF.</p> <ul> <li><code>--no_sort</code></li> </ul> <p>This option skips the sorting step if BAM files are already sorted by read name (e.g. Hi-C files generated by HiCUP). Please note that setting <code>--no_sort</code> for unsorted paired-end  files will break the tagging process!</p> <ul> <li><code>--hic</code></li> </ul> <p>Assumes Hi-C data processed with HiCUP as input, i.e. the input BAM file is paired-end and Reads 1 and 2 follow each other. Thus, this option also sets the flags <code>--paired</code> and <code>--no_sort</code>. Default: OFF.</p> <ul> <li><code>--bisulfite</code></li> </ul> <p>Assumes Bisulfite-Seq data processed with Bismark as input. In paired-end mode (<code>--paired</code>), Read 1 and Read 2 of a pair are expected to follow each other in consecutive lines. SNPsplit will run a quick check at the start of a run to see if the provided file appears to be a Bismark file, and set the flags <code>--bisulfite</code> and/or <code>--paired</code> automatically. In addition it will perform a quick check to see if a paired-end file appears to have been positionally sorted, and if not will set the flag <code>--no_sort</code>.</p> <ul> <li><code>--samtools-path</code></li> </ul> <p>The path to your Samtools installation, e.g. <code>/home/user/samtools/</code>. Does not need to be specified explicitly if Samtools is in the <code>PATH</code> environment already.</p>"},{"location":"options/SNPsplit_options/#snpsplit-sort-specific-options-tag2sort","title":"SNPsplit-sort specific options (tag2sort):","text":"<ul> <li><code>--sam</code></li> </ul> <p>The output will be written out in SAM format instead of BAM (default). SNPsplit will attempt to use the path to Samtools that was specified with <code>--samtools_path</code>, or, if it hasn't been specified, attempt to find Samtools in the <code>PATH</code> environment. If no installation of Samtools can be found, the SAM output will be compressed with GZIP instead (yielding a <code>.sam.gz</code> output file).</p> <ul> <li><code>--skip_tag2sort</code></li> </ul> <p>Carry out the allele-tagging process, and exit afterwards. This might be desirable when using SNPsplit in pipelining systems, such as Nextflow, when a deduplication step is to be added following allele tagging.</p> <ul> <li><code>--conflicting/--weird</code></li> </ul> <p>Reads or read pairs that were classified as 'Conflicting' (<code>XX:Z:CF</code>) will be written to an extra file (ending in <code>.conflicting.bam</code>) instead of being simply skipped. Reads may be classified as 'Conflicting' if a single read contains SNP information for both genomes at the same time, or if the SNP position was deleted from the read. Read-pairs are considered 'Conflicting' if either read is was tagged with the <code>XX:Z:CF</code> flag. Default: OFF.</p> <ul> <li><code>--help</code></li> </ul> <p>Displays this help information and exits</p> <ul> <li><code>--verbose</code></li> </ul> <p>(Very!) verbose output (for debugging)</p> <ul> <li><code>--version</code></li> </ul> <p>Displays version information and exits</p>"},{"location":"options/genome_prep_options/","title":"Genome preparation","text":""},{"location":"options/genome_prep_options/#full-list-of-options-for-snpsplit_genome_preparation","title":"Full list of options for SNPsplit_genome_preparation","text":"<p>Note</p> <p>USAGE: <code>SNPsplit_genome_preparation  [options] --vcf_file &lt;file&gt; --reference_genome /path/to/genome/ --strain &lt;strain_name&gt;</code></p>  <ul> <li><code>--vcf_file &lt;file&gt;</code></li> </ul> <p>Mandatory file specifying SNP information for mouse strains from the Mouse Genomes Project: v8 annotation file. The file used and approved is called mgp_REL2021_snps.vcf.gz. Please note that future versions of this file or entirely different VCF files might not work out-of-the-box but may require some tweaking. SNP calls are read from the VCF files, and high confidence SNPs are written into  a folder in the current working directory called <code>SNPs_&lt;strain_name&gt;/chr&lt;chromosome&gt;.txt</code>, in the following format:</p> <pre><code>             SNP-ID     Chromosome  Position    Strand   Ref/SNP\n example:   33941939        9       68878541       1       T/G\n</code></pre> <ul> <li><code>--v7_VCF</code></li> </ul> <p>This will use the file mgp_REL2005_snps_indels.vcf.gz instead of the mgp v8 file mentioned above, for backward compatibility reasons. This file contains both SNP and INDEL information, but INDELs are skipped. </p>  <p>Note</p> <p>NOTE: The v5 and v7 files work for the GRCm38 (now outdated) genome build!</p>  <ul> <li><code>--strain &lt;strain_name&gt;</code></li> </ul> <p>The strain you would like to use as SNP (ALT) genome. Mandatory. For an overview of strain names just run SNPsplit_genome_preparation selecting <code>--list_strains</code></p> <ul> <li><code>--list_strains</code></li> </ul> <p>Displays a list of strain names present in the VCF file for use with <code>--strain &lt;strain_name&gt;</code></p> <ul> <li><code>--dual_hybrid</code></li> </ul> <p>Optional. The resulting genome will no longer relate to the original reference specified with <code>--reference_genome</code>. Instead the new Reference (Ref) is defined by <code>--strain - &lt;strain_name&gt;</code> and the new SNP genome is defined by <code>--strain2 &lt;strain_name&gt;</code>. <code>--dual_hybrid</code> automatically sets <code>--full_sequence</code>.</p> <p>This will invoke a multi-step process:</p> <p>1) Read/filter SNPs for first strain (specified with <code>--strain &lt;strain_name&gt;</code>)</p> <p>2) Write full SNP incorporated (and optionally N-masked) genome sequence for first strain</p> <p>3) Read/filter SNPs for second strain (specified with <code>--strain2 &lt;strain_name&gt;</code>)</p> <p>4) Write full SNP incorporated (and optionally N-masked) genome sequence for second strain</p> <p>5) Generate new Ref/Alt SNP annotations for Strain1/Strain2</p> <p>6) Set first strain as new reference genome and construct full SNP incorporated (and optionally N-masked) genome sequences for Strain1/Strain2</p> <ul> <li><code>--strain2 &lt;strain_name&gt;</code></li> </ul> <p>Optional for constructing dual hybrid genomes (see <code>--dual_hybrid</code> for more information). For an overview of strain names just run <code>SNPsplit_genome_preparation</code> selecting <code>--list_strains</code></p> <ul> <li><code>--reference_genome</code></li> </ul> <p>The path to the reference genome, typically the strain 'Black6' (C57BL/6J), e.g. <code>--reference_genome /scratch/Genomes/Mouse/GRCm39/</code>. Expects one or more FastA files in this folder (file extension: <code>.fa</code> or <code>.fasta</code>)</p> <ul> <li><code>--skip_filtering</code></li> </ul> <p>This option skips reading and filtering the VCF file. This assumes that a folder named <code>SNPs_&lt;Strain_Name&gt;</code> exists in the working directory, and that text files with SNP information are contained therein in the following format:</p> <pre><code>            SNP-ID     Chromosome  Position    Strand   Ref/SNP\nexample:   33941939        9       68878541       1       T/G\n</code></pre> <ul> <li><code>--nmasking</code></li> </ul> <p>Write out a genome version for the strain specified where Ref bases are replaced with <code>N</code>. In the Ref/SNP example <code>T/G</code> the N-masked genome would now carry an <code>N</code> instead of the <code>T</code>. The N-masked genome is written to a folder called  <code>&lt;strain_name&gt;_N-masked/</code>. Default: ON</p> <ul> <li><code>--full_sequence</code></li> </ul> <p>Write out a genome version for the strain specified where Ref bases are replaced with the SNP base. In the Ref/SNP example <code>T/G</code> the full sequence genome would now carry a G instead of the T. The full sequence genome is written out to folder called <code>&lt;strain_name&gt;_full_sequence/</code>. May be set in addition to <code>--nmasking</code>. Default: OFF</p> <ul> <li><code>--no_nmasking</code></li> </ul> <p>Disable N-masking if it is not desirable. Will automatically set <code>--full_sequence</code> instead</p> <ul> <li><code>--genome_build [name]</code></li> </ul> <p>Name of the genome build incorporated into some of the output files. Defaults to 'GRCm39'</p> <ul> <li><code>--help</code></li> </ul> <p>Displays this help information and exits</p> <ul> <li><code>--version</code></li> </ul> <p>Displays version information and exits</p>"}]}